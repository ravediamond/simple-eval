{% extends "base.html" %}

{% block title %}Upload Evaluation Dataset - EvalNow{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1>Upload Evaluation Dataset</h1>
            <a href="/datasets" class="btn btn-secondary">Back to Evaluation Datasets</a>
        </div>
        <p class="text-muted">Upload a CSV or JSONL file with questions and reference answers</p>
    </div>
</div>

{% if error %}
<div class="row mt-3">
    <div class="col-12">
        <div class="alert alert-danger" role="alert">
            {{ error }}
        </div>
    </div>
</div>
{% endif %}

{% if errors %}
<div class="row mt-3">
    <div class="col-12">
        <div class="alert alert-danger" role="alert">
            <h5>Validation Errors</h5>
            <ul class="mb-0">
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}

{% if preview_rows %}
<div class="row mt-3">
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            <h5>Preview (first 10 rows of {{ total_rows }} total)</h5>
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Question</th>
                            <th>Reference</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in preview_rows %}
                        <tr>
                            <td>{{ row.question[:100] }}{% if row.question|length > 100 %}...{% endif %}</td>
                            <td>{{ row.reference[:100] }}{% if row.reference|length > 100 %}...{% endif %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>Evaluation Dataset Information</h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="name" class="form-label">Evaluation Dataset Name</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               value="{{ name or '' }}" required>
                        <div class="form-text">A descriptive name for your evaluation dataset</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" 
                                  rows="3">{{ description or '' }}</textarea>
                        <div class="form-text">Optional description of the evaluation dataset</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="file" class="form-label">Evaluation Dataset File</label>
                        <input type="file" class="form-control" id="file" name="file" 
                               accept=".csv,.jsonl" required>
                        <div class="form-text">CSV or JSONL file with 'question' and 'reference' columns</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Upload Evaluation Dataset</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>File Format Requirements</h5>
            </div>
            <div class="card-body">
                <h6>CSV Format</h6>
                <ul>
                    <li>Must include header row with column names</li>
                    <li>Required columns: <code>question</code>, <code>reference</code></li>
                    <li>Optional columns: <code>id</code> (auto-generated if missing)</li>
                    <li>UTF-8 encoding recommended</li>
                </ul>
                
                <h6>JSONL Format</h6>
                <ul>
                    <li>One JSON object per line</li>
                    <li>Required fields: <code>"question"</code>, <code>"reference"</code></li>
                    <li>Optional fields: <code>"id"</code> (auto-generated if missing)</li>
                    <li>UTF-8 encoding recommended</li>
                </ul>
                
                <h6>Example CSV</h6>
                <pre class="bg-light p-2"><code>id,question,reference
1,"What is the capital of France?","Paris"
2,"What is 2+2?","4"</code></pre>
                
                <h6>Example JSONL</h6>
                <pre class="bg-light p-2"><code>{"id": "1", "question": "What is the capital of France?", "reference": "Paris"}
{"id": "2", "question": "What is 2+2?", "reference": "4"}</code></pre>
            </div>
        </div>
    </div>
</div>
{% endblock %}